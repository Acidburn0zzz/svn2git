#!/bin/sh

set -e
set -u

install -m 0700 -d tmp
install -m 0700 -d var

rootdir="${PWD}/$(mktemp -d tmp/convert.XXXXXXXX)"
rundir="${PWD}/run.d"

export SVN2GIT_AUTHORS="${PWD}/tmp/munin.svn/authors"
export SVN2GIT_SVN_REPO=svn+ssh://munin-monitoring.org/svn/munin
export SVN2GIT_SVN_WORKDIR="${PWD}/tmp/munin.svn"
export SVN2GIT_ROOTDIR=$rootdir

cd $rootdir
run-parts --verbose --exit-on-error ${rundir}

# Update "munin" symlink to point to latest successful run.
rm -f munin
ln -s ${rootdir}/munin.svn2git munin
